name: Monitor Hanikorekhar Repository

on:
  schedule:
    - cron: "*/5 * * * *"   # æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
workflow_dispatchï¼š# æ”¯æŒæ‰‹åŠ¨è§¦å‘

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Install jq
        run: |
sudo apt-getæ›´æ–°
sudo apt-get install-y jq

      - name: Check repository updates
        run: |
owner="vampycloudia"
repo="hanikorekhar"
last_FILE="last.txt"

          # è·å–æœ€æ–°æäº¤æ–‡ä»¶åˆ—è¡¨
files=$(curl-s https://api.github.com/repos/$OWNER/$REPO/commits/main\
|jq-r'.[0].files[].filename')

          # ç¬¬ä¸€æ¬¡è¿è¡Œï¼Œä¿å­˜æ–‡ä»¶åˆ—è¡¨å¹¶é€€å‡º
å¦‚æœ[ï¼-f$LAST_FILE]ï¼›åˆ™
echo"$FILES">$LAST_FILE
é€€å‡º0
Fi

          # è¯»å–ä¸Šæ¬¡ä¿å­˜çš„æ–‡ä»¶åˆ—è¡¨
old=$(cat$LAST_FILE)

          # æ‰¾å‡ºæ›´æ–°æ–‡ä»¶
updated_FILES=$(comm-13<(echo"$OLD"|sort)<(echo"$FILES"|sort)||true)

å¦‚æœ[ï¼-z"$UPDATED_FILES"]ï¼›åˆ™
echo"$FILES">$LAST_FILE

            # å¾ªç¯æ›´æ–°æ–‡ä»¶å‘é€ Telegram æé†’
å¯¹äº$UPDATED_FILESï¼›ä¸­çš„æ–‡ä»¶ï¼Œè¯·æ‰§è¡Œ
å¦‚æœ["$file"="IllI.exe"]ï¼›åˆ™
message="ğŸš¨ ä»¿çœŸåŠ è½½å™¨å·²æ›´æ–°ï¼šhttps://github.com/$OWNER/$REPO"
Elif["$file"="libvampy64.so"]ï¼›ç„¶å
message="ğŸš¨ Directäº‘å·²æ›´æ–°ï¼šhttps://github.com/$OWNER/$REPO"
Elif["$file"="libvampybeta64.so"]ï¼›ç„¶å
æ¶ˆæ¯=ğŸš¨ è´å¡”"ç‰ˆæœ¬å·²æ›´æ–°ï¼šhttps://github.com/$OWNER/$REPO"
å…¶ä»–
message="ğŸš¨ å­˜å‚¨åº“å·²æ›´æ–°ï¼š$file"
Fi

              # å‘é€ Telegram æ¶ˆæ¯
curl-s-X POST"https://api.telegram.org/bot${{secrets.BOT_TOKEN}}/sendMessage"\
-h"å†…å®¹ç±»å‹ï¼šåº”ç”¨ç¨‹åº/json"\
-d"{\"chat_id\"ï¼š\"${{secrets.CHAT_ID}}\"ï¼Œ\"text\"ï¼š\"$MESSAGE\"}"
å·²å®Œæˆ
Fi
